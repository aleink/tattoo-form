<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Artist Pricing Form • Club Tattoo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ======== dark-theme / mobile-first styles ========= -->
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Helvetica Neue',Arial,sans-serif;
      background:#111;
      color:#eee;
      line-height:1.5;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      padding:20px;
    }
    h1{font-size:1.8rem;font-weight:700;margin-bottom:10px;text-align:center}
    #msg{margin-top:12px}

    /* card that holds each sample */
    .card{
      background:#222;
      border:1px solid #444;
      border-radius:8px;
      padding:16px;
      margin-bottom:18px;
    }
    .card h3{
      font-size:1.1rem;
      margin-bottom:6px;
      color:#fff;
    }
    .small{font-size:.85em;color:#aaa;margin-bottom:12px}

    label{display:block;font-weight:600;margin:0 0 4px}
    input[type=number]{
      width:100%;
      background:#111;
      color:#fff;
      border:1px solid #555;
      border-radius:4px;
      padding:8px;
      font-size:0.95rem;
    }
    input[type=number]::placeholder{color:#777}

    /* two-column grid on desktop, 1 column on phones */
    .grid{
      display:grid;
      gap:14px;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    }

    button{
      align-self:center;
      background:#2c7be5;
      color:#fff;
      border:none;
      border-radius:4px;
      padding:12px 28px;
      font-size:1rem;
      cursor:pointer;
      margin-top:20px;
    }
    button:disabled{background:#666;cursor:default}
  </style>
</head>
<body>

  <h1>Artist Pricing & Time Estimates</h1>
  <p class="small" style="text-align:center;max-width:600px;margin:0 auto 20px;">
    Enter your price (USD) and how long each piece would take you
    <br>(time in multiples of 5 minutes). Fill as many as you like, then tap **Send**.
  </p>

  <!-- sample cards injected here -->
  <div id="samples"></div>

  <button id="submitBtn">Send answers</button>
  <p id="msg" class="small"></p>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js"></script>
  <script>
  /* ---- Supabase connection ---- */
  const SUPABASE_URL  = 'https://shlvjhipxnslrncczopn.supabase.co';
  const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNobHZqaGlweG5zbHJuY2N6b3BuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2NDgzNjIsImV4cCI6MjA2MjIyNDM2Mn0.oPrYFyW0IsDnNsDpQ9LI0cOm6Y7OIJbjebp2Zjvv_qQ';
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

  /* ---- 1. Load all samples ---- */
  async function loadSamples(){
    const {data,error}=await sb.from('samples').select('*').order('id');
    if(error){document.getElementById('msg').textContent='Cannot load samples.';return;}
    const wrap=document.getElementById('samples');
    data.forEach(s=>{
      const div=document.createElement('div');div.className='card';
      div.innerHTML=`
        <h3>#${s.id} – ${s.description}</h3>
        <p class="small">${s.friendly_style} • ${s.size_inches} inches</p>
        <div class="grid">
          <div>
            <label>Price (USD)</label>
            <input type="number" min="0" step="1" placeholder="0" data-price data-sample="${s.id}">
          </div>
          <div>
            <label>Time (mins)</label>
            <input type="number" min="5" step="5" placeholder="0" data-time data-sample="${s.id}">
          </div>
        </div>`;
      wrap.appendChild(div);
    });
  }
  loadSamples();

  /* ---- 2. Submit answers ---- */
  document.getElementById('submitBtn').onclick = async ()=>{
    const rows=[];
    document.querySelectorAll('[data-price]').forEach(el=>{
      const sampleId  = +el.dataset.sample;
      const price     = +el.value||0;
      const timeField = document.querySelector(`[data-time][data-sample="${sampleId}"]`);
      const time      = +timeField.value||0;
      if(price>0 && time>0){
        rows.push({sample_id:sampleId,price_usd:price,time_minutes:time});
      }
    });

    if(!rows.length){
      alert('Please enter at least one complete pair of values.');
      return;
    }

    const {error}=await sb.from('artists_answers').insert(rows);
    if(error){
      alert('Save error – please try again.');
      return;
    }

    document.getElementById('msg').textContent='Thanks! Your answers were saved.';
    document.getElementById('submitBtn').disabled=true;
  };
  </script>
</body>
</html>
