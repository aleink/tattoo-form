<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Artist Pricing Form • Club Tattoo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Helvetica Neue',Arial,sans-serif;background:#111;color:#eee;
      min-height:100vh;display:flex;flex-direction:column;padding:20px;line-height:1.5}
    h1{font-size:1.8rem;font-weight:700;margin-bottom:10px;text-align:center}
    .small{font-size:.85em;color:#aaa;margin-bottom:12px;text-align:center}
    .card{background:#222;border:1px solid #444;border-radius:8px;padding:16px;margin-bottom:18px}
    .card h3{font-size:1.1rem;margin-bottom:6px;color:#fff}
    label{display:block;font-weight:600;margin:0 0 4px}
    input[type=number]{width:100%;background:#111;color:#fff;padding:8px;
      border:1px solid #555;border-radius:4px;font-size:.95rem}
    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
    .time-wrap{display:flex;gap:6px}
    button{align-self:center;background:#2c7be5;color:#fff;border:none;border-radius:4px;
      padding:12px 28px;font-size:1rem;cursor:pointer;margin-top:20px}
    button:disabled{background:#666}
  </style>
</head>
<body>

  <h1>Artist Pricing & Time Estimates</h1>
  <p class="small">
    Enter price (USD) and time for <b>one session</b>.  
    If a design needs more than one session, set the sessions field.
  </p>

  <div id="samples"></div>

  <button id="submitBtn">Send answers</button>
  <p id="msg" class="small"></p>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js"></script>
  <script>
  /* Supabase keys */
  const sb = window.supabase.createClient(
    'https://shlvjhipxnslrncczopn.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNobHZqaGlweG5zbHJuY2N6b3BuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2NDgzNjIsImV4cCI6MjA2MjIyNDM2Mn0.oPrYFyW0IsDnNsDpQ9LI0cOm6Y7OIJbjebp2Zjvv_qQ'
  );

  /* Load reference samples */
  async function loadSamples(){
    const {data,error}=await sb.from('samples').select('*').order('id');
    if(error){document.getElementById('msg').textContent='Cannot load samples.';return;}
    const wrap=document.getElementById('samples');
    data.forEach(s=>{
      const div=document.createElement('div');div.className='card';
      div.innerHTML=`
        <h3>#${s.id} – ${s.description}</h3>
        <p class="small">${s.friendly_style} • ${s.size_inches} inches</p>
        <div class="grid">
          <div>
            <label>Price (USD)</label>
            <input type="number" min="0" step="1" placeholder="0"
                   data-price data-sample="${s.id}">
          </div>
          <div>
            <label>Hours</label>
            <input type="number" min="0" step="1" placeholder="0"
                   data-hours data-sample="${s.id}">
          </div>
          <div>
            <label>Minutes</label>
            <input type="number" min="0" max="55" step="5" placeholder="0"
                   data-mins data-sample="${s.id}">
          </div>
          <div>
            <label>Sessions</label>
            <input type="number" min="1" step="1" value="1"
                   data-sessions data-sample="${s.id}">
          </div>
        </div>`;
      wrap.appendChild(div);
    });
  }
  loadSamples();

  /* Submit rows */
  document.getElementById('submitBtn').onclick = async ()=>{
    const rows=[];
    document.querySelectorAll('[data-price]').forEach(el=>{
      const id = +el.dataset.sample;
      const price = +el.value||0;
      const hrs = +document.querySelector(`[data-hours][data-sample="${id}"]`).value||0;
      const mins= +document.querySelector(`[data-mins][data-sample="${id}"]`).value||0;
      const sessions = +document.querySelector(`[data-sessions][data-sample="${id}"]`).value||1;
      const totalMinutes = hrs*60 + mins;
      if(price>0 && totalMinutes>0){
        rows.push({
          sample_id:id,
          price_usd:price,
          time_minutes:totalMinutes,
          sessions:sessions
        });
      }
    });

    if(!rows.length){
      alert('Please fill at least one complete estimate.');
      return;
    }

    const {error}=await sb.from('artists_answers').insert(rows);
    if(error){alert('Save error');return;}

    document.getElementById('msg').textContent='Thanks! Your answers were saved.';
    document.getElementById('submitBtn').disabled=true;
  };
  </script>
</body>
</html>
