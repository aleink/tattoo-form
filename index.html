<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Club Tattoo Management Tool</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<!-- ─── minimal static styling (same palette as other pages) ─── -->
<style>
:root{--bg0:#111;--bg1:#222;--bg2:#333;--border:#444;--txt:#fff;--txt-dim:#bbb;--accent:#28a745}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Helvetica Neue',Arial,sans-serif}
body{background:var(--bg0);color:var(--txt);min-height:100vh;display:flex;flex-direction:column}
header,footer{background:#000;border-bottom:2px solid var(--border);text-align:center;padding:20px}
footer{border-top:2px solid var(--border);border-bottom:none;margin-top:auto}
header h1{font-size:2rem;margin-bottom:8px}
header p{font-size:1rem;color:var(--txt-dim)}
main{flex:1;display:flex;flex-direction:column;align-items:center;padding:40px 20px;max-width:1200px;margin:0 auto}
.links-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;width:100%;max-width:900px;margin-top:30px}
.card{background:var(--bg1);border:1px solid var(--border);border-radius:6px;text-align:center;padding:22px;transition:background .2s}
.card:hover{background:var(--bg2)}
.card h2{font-size:1.2rem;margin-bottom:10px}
.card p{font-size:.9rem;color:var(--txt-dim);min-height:40px;margin-bottom:18px}
.card a{display:inline-block;padding:8px 16px;border-radius:4px;background:#777;color:#fff;text-decoration:none;transition:background .2s}
.card a:hover{background:#999}
#login-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.7);z-index:999}
#login-box{background:var(--bg1);border:1px solid var(--border);border-radius:6px;padding:26px;width:90%;max-width:420px}
#login-box h3{margin-bottom:14px;text-align:center}
label{display:block;font-weight:700;margin:10px 0 4px}
input{width:100%;padding:8px;background:var(--bg0);color:var(--txt);border:1px solid var(--border);border-radius:4px}
button{margin-top:14px;width:100%;padding:9px;background:var(--bg2);border:none;border-radius:4px;color:var(--txt);cursor:pointer}
button:hover{background:#555}
#login-msg{color:#ff6262;font-size:. nine0em;margin-top:10px;text-align:center}
@media(max-width:600px){.card p{min-height:auto;margin-bottom:12px}}
</style>
</head>
<body>

<header>
  <h1>Club Tattoo Management Tool</h1>
  <p id="welcome-line">Please log-in to access modules.</p>
</header>

<!-- ───── LOGIN OVERLAY ───── -->
<div id="login-modal">
  <div id="login-box">
    <h3>Staff Login</h3>
    <label>Email</label><input id="email" type="email" autocomplete="username">
    <label>Password</label><input id="password" type="password" autocomplete="current-password">
    <button id="login-btn">Login</button>
    <div id="login-msg"></div>
  </div>
</div>

<main>
  <h2 style="font-size:1.3rem;margin-bottom:20px;">Modules</h2>

  <div class="links-grid">
    <!-- CALENDAR (all roles that can see calendar) -->
    <div class="card" data-role="gm,owner,sm,fd">
      <h2>Calendar</h2>
      <p>View &amp; manage appointments and schedules.</p>
      <a href="calendar.html" target="_blank">Open Calendar</a>
    </div>

    <!-- ARTISTS -->
    <div class="card" data-role="gm,owner,sm">
      <h2>Artists</h2>
      <p>Add, edit, or remove tattoo artists.</p>
      <a href="manage_artists.html" target="_blank">Manage Artists</a>
    </div>

    <!-- SCHEDULES -->
    <div class="card" data-role="gm,owner,sm">
      <h2>Schedules</h2>
      <p>Assign weekly working hours.</p>
      <a href="manage_schedules.html" target="_blank">Manage Schedules</a>
    </div>

    <!-- VACATIONS -->
    <div class="card" data-role="gm,owner,sm">
      <h2>Vacations</h2>
      <p>Block out vacation dates for artists.</p>
      <a href="manage_vacations.html" target="_blank">Manage Vacations</a>
    </div>

    <!-- PAYROLL -->
    <div class="card" data-role="gm,owner,ad">
      <h2>Payroll</h2>
      <p>Calculate artist earnings.</p>
      <a href="artists_payroll.html" target="_blank">Open Payroll</a>
    </div>

    <!-- LOCATIONS -->
    <div class="card" data-role="gm,owner">
      <h2>Locations</h2>
      <p>Add / edit shop locations &amp; hours.</p>
      <a href="manage_locations.html" target="_blank">Manage Locations</a>
    </div>
  </div>
</main>

<footer>
  <p>&copy; <span id="year"></span> Club Tattoo</p>
</footer>

<!-- ─── SUPABASE ─── -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js"></script>
<script>
const supabase = window.supabase.createClient(
  'https://shlvjhipxnslrncczopn.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNobHZqaGlweG5zbHJuY2N6b3BuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2NDgzNjIsImV4cCI6MjA2MjIyNDM2Mn0.oPrYFyW0IsDnNsDpQ9LI0cOm6Y7OIJbjebp2Zjvv_qQ'
);

/* footer year */
document.getElementById('year').textContent=new Date().getFullYear();

/* DOM refs */
const modal=document.getElementById('login-modal');
const emailInp=document.getElementById('email');
const passInp=document.getElementById('password');
const btn=document.getElementById('login-btn');
const msg=document.getElementById('login-msg');
const welcome=document.getElementById('welcome-line');
const cards=[...document.querySelectorAll('.card')];

/* attempt auto-login if role already in storage */
(function autoFill(){
  const role=localStorage.getItem('currentUserRole');
  if(role){
    welcome.textContent='Welcome back!';
    filterCards(role);
    modal.style.display='none';
  }
})();

/* login click */
btn.onclick=async()=>{
  msg.textContent='';
  if(!emailInp.value||!passInp.value){msg.textContent='Email and password required.';return;}

  const {data,error}=await supabase.from('users').select('*').eq('email',emailInp.value.trim());
  if(error||!data?.length){msg.textContent='Invalid credentials.';return;}
  const u=data[0];
  if(u.password_hash!==passInp.value.trim()){msg.textContent='Invalid credentials.';return;}

  /* store session for other pages */
  localStorage.setItem('currentUserId',u.id);
  localStorage.setItem('currentUserRole',u.role);
  localStorage.setItem('currentLocation',u.location_id||'');

  /* UI changes */
  filterCards(u.role);
  welcome.textContent=`Welcome, ${u.role.toUpperCase()}!`;
  modal.style.display='none';
};

/* role-based card visibility */
function filterCards(role){
  cards.forEach(c=>{
    const access=c.dataset.role.split(',');
    c.style.display=access.includes(role)?'block':'none';
  });
}
</script>
</body>
</html>
