<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Schedules</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- ─── CSP ─── -->
<meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net;
        connect-src 'self' https://shlvjhipxnslrncczopn.supabase.co wss://shlvjhipxnslrncczopn.supabase.co;
        style-src 'self' 'unsafe-inline';
        object-src 'none';
      ">

<!-- ─── THEMES ─── -->
<style>
:root{                              /* DARK (default) */
  --bg0:#111;--bg1:#222;--bg2:#333;
  --border:#444;--txt:#fff;--txt-dim:#ccc;--accent:#28a745;
}
body.light{                         /* LIGHT override */
  --bg0:#f7f7f7;--bg1:#fff;--bg2:#e6e6e6;
  --border:#b7b7b7;--txt:#000;--txt-dim:#444;--accent:#0d6efd;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Helvetica Neue',Arial,sans-serif}
body{
  background:var(--bg0);color:var(--txt);
  max-width:820px;margin:32px auto;padding:28px;
  transition:background .25s,color .25s;
}
h1{font-size:1.8rem;text-align:center;margin-bottom:24px}
h2,h3{margin:10px 0 14px;font-size:1.25rem}
p {font-size:.9em;color:var(--txt-dim)}

.card{
  background:var(--bg1);border:1px solid var(--border);
  border-radius:6px;padding:22px;margin-bottom:30px;
}

label{display:block;font-weight:700;margin:10px 0 4px}
input,select{
  width:100%;padding:8px;background:var(--bg0);color:var(--txt);
  border:1px solid var(--border);border-radius:4px;margin-bottom:12px
}
input:focus,select:focus{outline:2px solid var(--accent)}

button{
  background:var(--bg2);color:var(--txt);border:none;border-radius:4px;
  padding:8px 16px;cursor:pointer;transition:background .2s
}
button:hover{background:#555}
.btn-mini{padding:4px 10px;font-size:.85em;margin-right:6px}

#top-bar{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
#top-bar.hidden{display:none}
#theme-btn{min-width:110px}

.message{color:#ff6262;font-size:.9em;margin-top:8px}
.hidden{display:none}

/* day blocks */
.days-container{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:16px;margin-top:16px
}
.day-block{
  background:var(--bg0);border:1px solid var(--border);
  border-radius:6px;padding:12px
}
.day-block h3{text-align:center;margin-bottom:10px;font-size:1rem;color:var(--accent)}
</style>
</head>
<body>
<h1>Manage Artist Schedules</h1>

<!--  TOP BAR (after login) -->
<div id="top-bar" class="hidden">
  <div style="font-weight:600">Schedules Manager</div>
  <div>
    <button id="theme-btn" class="btn-mini">Light mode</button>
    <button id="logout-btn" class="btn-mini">Logout</button>
  </div>
</div>

<!--  LOGIN  -->
<div id="login-section" class="card">
  <label>Email</label><input id="login-email" type="email" autocomplete="username">
  <label>Password</label><input id="login-pass" type="password" autocomplete="current-password">
  <button id="login-btn">Login</button>
  <div id="login-msg" class="message"></div>
</div>

<!--  MAIN  -->
<div id="sched-section" class="card hidden">
  <h2>Assign Working Days & Hours</h2>

  <label>Location</label>
  <select id="loc-filter"><option value="">-- Select Location --</option></select>

  <label>Artist</label>
  <select id="artist-filter"><option value="">-- Select Artist --</option></select>

  <hr style="border-color:var(--border);margin:20px 0">

  <h3>Weekly Schedule</h3>
  <p>Select start/end time for each day. Leave blank if the artist is off.</p>

  <div id="days-wrap" class="days-container"></div>

  <button id="save-btn" style="margin-top:14px">Save Schedule</button>
  <div id="sched-msg" class="message"></div>
</div>

<!--  SUPABASE  -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js"></script>
<script>
/* ----------  INIT ---------- */
const supabase = window.supabase.createClient(
  'https://shlvjhipxnslrncczopn.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNobHZqaGlweG5zbHJuY2N6b3BuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2NDgzNjIsImV4cCI6MjA2MjIyNDM2Mn0.oPrYFyW0IsDnNsDpQ9LI0cOm6Y7OIJbjebp2Zjvv_qQ'
);

/* ----------  DOM ---------- */
const topBar     = document.getElementById('top-bar');
const themeBtn   = document.getElementById('theme-btn');
const logoutBtn  = document.getElementById('logout-btn');

const loginSec   = document.getElementById('login-section');
const loginEmail = document.getElementById('login-email');
const loginPass  = document.getElementById('login-pass');
const loginBtn   = document.getElementById('login-btn');
const loginMsg   = document.getElementById('login-msg');

const schedSec   = document.getElementById('sched-section');
const locFilter  = document.getElementById('loc-filter');
const artistFilter = document.getElementById('artist-filter');
const daysWrap   = document.getElementById('days-wrap');
const saveBtn    = document.getElementById('save-btn');
const schedMsg   = document.getElementById('sched-msg');

/* ----------  THEME ---------- */
(function(){
  if(localStorage.getItem('ui-theme')==='light'){
    document.body.classList.add('light');
    themeBtn.textContent='Dark mode';
  }
})();
themeBtn.onclick = ()=>{
  const light=document.body.classList.toggle('light');
  themeBtn.textContent = light ? 'Dark mode' : 'Light mode';
  localStorage.setItem('ui-theme',light?'light':'dark');
};

/* ----------  STATE ---------- */
let role='', scopeLoc='';
const dayNames=[
  {key:'sunday',label:'Sunday'},
  {key:'monday',label:'Monday'},
  {key:'tuesday',label:'Tuesday'},
  {key:'wednesday',label:'Wednesday'},
  {key:'thursday',label:'Thursday'},
  {key:'friday',label:'Friday'},
  {key:'saturday',label:'Saturday'}
];
const dayInputs={};                 // { sunday:{start,end},
